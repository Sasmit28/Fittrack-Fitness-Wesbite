<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalized Diet Plan</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            scroll-behavior: smooth;
        }
        .hero {
            background-image: url('https://source.unsplash.com/1600x900/?healthy-food');
            background-size: cover;
            background-position: center;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }
        .hero-content {
            background-color: rgba(0, 0, 0, 0.6);
            padding: 2rem;
            border-radius: 10px;
        }
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }
        .cta-button {
            background-color: #4CAF50;
            color: white;
            padding: 1rem 2rem;
            text-decoration: none;
            border-radius: 5px;
            font-size: 1.2rem;
            transition: background-color 0.3s;
        }
        .cta-button:hover {
            background-color: #45a049;
        }
        .form-section {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        form {
            display: grid;
            gap: 1rem;
        }
        label {
            font-weight: bold;
        }
        select, button {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="hero">
        <div class="hero-content">
            <h1>Your Personalized Diet Plan</h1>
            <p>Get a customized diet plan tailored to your needs and goals.</p>
            <a href="#dietForm" class="cta-button">Start Now</a>
        </div>
    </div>

    <div class="form-section">
        <h2>Diet Plan Questionnaire</h2>
        <form id="dietForm">
            <label for="height">Height (cm):</label>
            <select id="height" name="height" required>
                <option value="">Select height</option>
                <option value="140">140 cm</option>
                <option value="145">145 cm</option>
                <option value="150">150 cm</option>
                <option value="155">155 cm</option>
                <option value="160">160 cm</option>
                <option value="165">165 cm</option>
                <option value="170">170 cm</option>
                <option value="175">175 cm</option>
                <option value="180">180 cm</option>
                <option value="185">185 cm</option>
                <option value="190">190 cm</option>
                <option value="195">195 cm</option>
                <option value="200">200 cm</option>
                <option value="205">205 cm</option>
                <option value="210">210 cm</option>
                <option value="215">215 cm</option>
                <option value="220">220 cm</option>
            </select>

            <label for="weight">Weight (kg):</label>
            <select id="weight" name="weight" required>
                <option value="">Select weight</option>
                <option value="40">40 kg</option>
                <option value="45">45 kg</option>
                <option value="50">50 kg</option>
                <option value="55">55 kg</option>
                <option value="60">60 kg</option>
                <option value="65">65 kg</option>
                <option value="70">70 kg</option>
                <option value="75">75 kg</option>
                <option value="80">80 kg</option>
                <option value="85">85 kg</option>
                <option value="90">90 kg</option>
                <option value="95">95 kg</option>
                <option value="100">100 kg</option>
                <option value="105">105 kg</option>
                <option value="110">110 kg</option>
                <option value="115">115 kg</option>
                <option value="120">120 kg</option>
                <option value="125">125 kg</option>
                <option value="130">130 kg</option>
                <option value="135">135 kg</option>
                <option value="140">140 kg</option>
                <option value="145">145 kg</option>
                <option value="150">150 kg</option>
            </select>

            <label for="goal">Weight Goal:</label>
            <select id="goal" name="goal" required>
                <option value="">Select goal</option>
                <option value="lose">Lose weight</option>
                <option value="gain">Gain weight</option>
            </select>

            <label for="meals">Number of meals per day:</label>
            <select id="meals" name="meals" required>
                <option value="">Select number of meals</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
            </select>

            <label for="dietType">Preferred diet type:</label>
            <select id="dietType" name="dietType" required>
                <option value="">Select diet type</option>
                <option value="Indian">Indian</option>
                <option value="Western">Western</option>
            </select>

            <label for="walkingTime">Daily walking time (minutes):</label>
            <select id="walkingTime" name="walkingTime" required>
                <option value="">Select walking time</option>
                <option value="0">None</option>
                <option value="15">15 minutes</option>
                <option value="30">30 minutes</option>
                <option value="45">45 minutes</option>
                <option value="60">60 minutes</option>
                <option value="75">75 minutes</option>
                <option value="90">90 minutes</option>
                <option value="105">105 minutes</option>
                <option value="120">120 minutes</option>
            </select>

            <label for="workType">Work type:</label>
            <select id="workType" name="workType" required>
                <option value="">Select work type</option>
                <option value="office">Office</option>
                <option value="wfh">Work from home</option>
            </select>

            <label for="workout">Workout frequency:</label>
            <select id="workout" name="workout" required>
                <option value="">Select workout frequency</option>
                <option value="daily">Daily</option>
                <option value="2-3">2-3 times a week</option>
                <option value="none">No workout at all</option>
            </select>

            <label for="sleep">Number of sleeping hours:</label>
            <select id="sleep" name="sleep" required>
                <option value="">Select sleeping hours</option>
                <option value="5">5 hours</option>
                <option value="6">6 hours</option>
                <option value="7">7 hours</option>
                <option value="8">8 hours</option>
                <option value="9">9 hours</option>
                <option value="10">10 hours</option>
                <option value="11">11 hours</option>
                <option value="12">12 hours</option>
            </select>

            <label for="supplements">Supplement consumption:</label>
            <select id="supplements" name="supplements" required>
                <option value="">Select supplement consumption</option>
                <option value="whey">Yes, only whey protein</option>
                <option value="other">Other supplements</option>
                <option value="both">Both whey protein and other supplements</option>
                <option value="none">None</option>
            </select>

            <button type="submit">Generate Diet Plan</button>
        </form>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const API_KEY = 'AIzaSyA73b13r8YEJYhDBCM5upCLiTXnD0DK2KQ';
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

        document.getElementById('dietForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const userInput = Object.fromEntries(formData.entries());

            const prompt = `Generate a personalized diet plan based on the following information:
            Height: ${userInput.height} cm
            Weight: ${userInput.weight} kg
            Goal: ${userInput.goal} weight
            Meals per day: ${userInput.meals}
            Diet type: ${userInput.dietType}
            Daily walking time: ${userInput.walkingTime} minutes
            Work type: ${userInput.workType}
            Workout frequency: ${userInput.workout}
            Sleeping hours: ${userInput.sleep}
            Supplement consumption: ${userInput.supplements}

            Please provide a detailed daily meal plan with specific food items and quantities, taking into account the user's preferences and goals. Include recommendations for calorie intake, macronutrient balance, and any specific dietary considerations based on the provided information.`;

            try {
                const response = await axios.post(API_URL, {
                    contents: [{ parts: [{ text: prompt }] }]
                }, {
                    params: { key: API_KEY },
                    headers: { 'Content-Type': 'application/json' }
                });

                console.log('Full API response:', response.data);

                let dietPlan = '';
                if (response.data && response.data.candidates && response.data.candidates.length > 0) {
                    const candidate = response.data.candidates[0];
                    if (candidate.content && candidate.content.parts && candidate.content.parts.length > 0) {
                        dietPlan = candidate.content.parts[0].text;
                    }
                }

                if (!dietPlan) {
                    dietPlan = "We're sorry, but we couldn't generate a personalized diet plan at this time. Please try again later.";
                }

                // Open a new window with the diet plan
                const newWindow = window.open('', '_blank');
                if (newWindow) {
                    newWindow.document.write(`
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <title>Your Personalized Diet Plan</title>
                            <style>
                                body { 
                                    font-family: Arial, sans-serif; 
                                    line-height: 1.6; 
                                    padding: 20px; 
                                    max-width: 800px; 
                                    margin: 0 auto; 
                                }
                                h1 { 
                                    color: #4CAF50; 
                                    text-align: center;
                                }
                                #dietPlan { 
                                    white-space: pre-wrap; 
                                    background-color: #f9f9f9;
                                    padding: 20px;
                                    border-radius: 5px;
                                }
                                .button { 
                                    display: block;
                                    width: 200px;
                                    background-color: #4CAF50; 
                                    color: white; 
                                    padding: 10px 20px; 
                                    text-decoration: none; 
                                    border-radius: 5px; 
                                    margin: 20px auto;
                                    text-align: center;
                                }
                            </style>
                        </head>
                        <body>
                            <h1>Your Personalized Diet Plan</h1>
                            <div id="dietPlan">${dietPlan}</div>
                            <a href="#" class="button" onclick="window.print(); return false;">Download/Print</a>
                        </body>
                        </html>
                    `);
                    newWindow.document.close();
                } else {
                    alert('Please allow pop-ups for this website to view your personalized diet plan.');
                }
            } catch (error) {
                console.error('Error generating diet plan:', error);
                let errorMessage = 'An error occurred while generating your diet plan. ';
                if (error.response) {
                    console.error('Error data:', error.response.data);
                    console.error('Error status:', error.response.status);
                    console.error('Error headers:', error.response.headers);
                    errorMessage += `Server responded with status ${error.response.status}.`;
                } else if (error.request) {
                    console.error('Error request:', error.request);
                    errorMessage += 'No response received from the server.';
                } else {
                    console.error('Error message:', error.message);
                    errorMessage += error.message;
                }
                alert(errorMessage + ' Please check the console for more details and try again later.');
            }
        });
    });
    </script>
</body>
</html>